name: Compile and Package Demo Pack

on:
  push:
    branches: [ "main", "master", "develop" ]
  pull_request:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 6.0.x

    - name: Restore dependencies
      # Apuntamos explÃ­citamente al csproj dentro de la subcarpeta
      run: dotnet restore MonstrosityDemoPack/MonstrosityDemoPack.csproj

    - name: Build C# Mod (Release Mode)
      # Compilamos especificando la ruta del proyecto
      run: dotnet build MonstrosityDemoPack/MonstrosityDemoPack.csproj --configuration Release --no-restore /p:EnableModDeploy=false

    - name: Create Release Structure
      run: |
        # Creamos las carpetas para ambos mods
        mkdir -p release/MonstrosityDemoPack
        mkdir -p "release/[CP] MonstrosityDemoPack"

    - name: Package C# Mod (MonstrosityDemoPack)
      run: |
        echo "ðŸ“¦ Packaging C# Mod..."
        # 1. Copiar DLL (La ruta de bin ahora estÃ¡ dentro de la subcarpeta)
        cp MonstrosityDemoPack/bin/Release/net6.0/MonstrosityDemoPack.dll release/MonstrosityDemoPack/
        
        # 2. Copiar Manifest
        cp MonstrosityDemoPack/manifest.json release/MonstrosityDemoPack/
        
        # 3. Copiar Assets (Si existen)
        if [ -d "MonstrosityDemoPack/assets" ]; then
          cp -r MonstrosityDemoPack/assets release/MonstrosityDemoPack/
        fi
        
        # 4. Copiar i18n (Si existe)
        if [ -d "MonstrosityDemoPack/i18n" ]; then
          cp -r MonstrosityDemoPack/i18n release/MonstrosityDemoPack/
        fi

    - name: Package Content Pack ([CP] MonstrosityDemoPack)
      run: |
        echo "ðŸ“¦ Packaging Content Pack..."
        # Usamos comillas porque el nombre tiene espacios y corchetes
        # Copiamos todo el contenido de la carpeta original a la carpeta release
        cp -r "[CP] MonstrosityDemoPack"/* "release/[CP] MonstrosityDemoPack/"

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: MonstrosityDemoPack_Bundle
        path: release/